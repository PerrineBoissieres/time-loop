!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("TimeLoop",[],t):"object"==typeof exports?exports.TimeLoop=t():e.TimeLoop=t()}(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(1),o=n(a),u=i(2),h=void 0,d=void 0,c=void 0,p=void 0,l=void 0,f=void 0,m=void 0,v=function(){function e(){var t=this;s(this,e),this.timers=[],this.elapsedTime=0,this.lastTime=0,this.paused=!0,this.started=!1,this.sortable=!1,this.autoSort=!0,this.defaultNamespace="all",this.fps=0,this.fpsLastTime=0,this.frameCount=0,this.proxyStep=this.step.bind(this),"undefined"!=typeof document.hidden&&document.addEventListener("visibilitychange",function(){document.hidden?t.pause():t.start()},!1)}return r(e,[{key:"time",get:function(){return Date.now()}}]),r(e,[{key:"step",value:function(){if(!this.paused){for(this.autoSort&&this.sortable&&(this.sort(),this.sortable=!1),h=d=this.time,this.elapsedTime=h-this.lastTime,this.lastTime=h,this.frameCount++,d-1e3>this.fpsLastTime&&(this.fps=this.frameCount,this.frameCount=0,this.fpsLastTime=d),f=this.timers.length,p=0;p<f;++p)m=this.timers[p],m.paused||m.ended||m.update(this.elapsedTime);window.requestAnimationFrame(this.proxyStep)}}},{key:"start",value:function(){this.paused&&(this.lastTime=this.time,this.fpsLastTime=this.time,this.elapsedTime=0,this.paused=!1,this.frameCount=0,this.started||(this.started=!0,window.requestAnimationFrame(this.proxyStep)))}},{key:"pause",value:function(){return this.paused=!0,this}},{key:"resume",value:function(){return this.start(),this}},{key:"sort",value:function(){return this.timers.sort(u.orderByPriority),this}},{key:"createPool",value:function(e){if(this.timers.length)throw new Error("Timers have already been created, cannot pre-allocate.");for(this.timers=new Array(e),p=0;p<e;p++)c=new o["default"],c.ended=!0,this.timers[p]=c;return this}},{key:"createTimer",value:function(e,t,i){return c=this.getFromPool(),t.namespace?t.namespace=this.defaultNamespace+"."+t.namespace:t.namespace=this.defaultNamespace,c?(c.callback=e,c.context=i||window,c.ended=!1,c.paused=!1,c.options(t)):(c=new o["default"](e,t,i),this.timers.push(c),this.sortable=!0,c)}},{key:"getFromPool",value:function(){for(p=0;p<this.timers.length;p++)if(c=this.timers[p],c.ended)return c;return!1}},{key:"namespace",value:function(e,t){var i=[];return this.timers.map(function(n){return!n.ended&&(0,u.checkNamespace)(n,e)&&(t&&"resume"===t?n.resume():t&&"pause"===t?n.pause():t&&"reset"===t?n.reset():t&&"end"===t&&n.end(),i.push(n)),n}),i}},{key:"wait",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return l=new Promise(function(i){e.createTimer(function(){return i()},{type:"timeout",time:t})})}},{key:"repeat",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return this.createTimer(e,{type:"interval",time:t},this)}}]),e}();t["default"]=v,e.exports=t["default"]},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(2),a=function(){function e(t,i,s){n(this,e),this.settings=(0,r.extendOptions)(this.defaultOptions,i),this.paused=!1,this.ended=!1,this.callback=t||void 0,this.context=s||window,this.elapsedTime=0}return s(e,[{key:"defaultOptions",get:function(){return{type:"timeout",time:0,priority:1,namespace:""}}}]),s(e,[{key:"options",value:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1];return t?this.settings=(0,r.extendOptions)(this.defaultOptions,e):this.settings=(0,r.extendOptions)(this.settings,e),this}},{key:"update",value:function(e){this.paused||this.ended||(this.elapsedTime+=e,this.elapsedTime>=this.settings.time&&(this.callback.call(this.context),this.elapsedTime=0,"timeout"===this.settings.type&&(this.ended=!0)))}},{key:"pause",value:function(){return this.paused=!0,this}},{key:"resume",value:function(){return this.paused=!1,this}},{key:"reset",value:function(){return this.elapsedTime=0,this}},{key:"end",value:function(){return this.ended=!0,this}}]),e}();t["default"]=a,e.exports=t["default"]},function(e,t){"use strict";function i(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function n(e,t){var n=new RegExp("^"+i(t));return!!n.test(e.settings.namespace)}function s(e,t){return t.settings.priority-e.settings.priority}function r(e,t){if(!t)return e;var i={};for(var n in e)({}).hasOwnProperty.call(e,n)&&(i[n]=e[n]);for(var s in t)({}).hasOwnProperty.call(t,s)&&(i[s]=t[s]);return i}Object.defineProperty(t,"__esModule",{value:!0}),t.escapeRegExp=i,t.checkNamespace=n,t.orderByPriority=s,t.extendOptions=r}])});
//# sourceMappingURL=time-loop.min.js.map